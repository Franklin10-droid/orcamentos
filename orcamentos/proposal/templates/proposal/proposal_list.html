{% extends 'base.html' %}
{% load core_status_tags %}

{% block title %}
  <title>Orçamentos</title>
{% endblock title %}

{% block content %}

<style>
  .card .card-footer{ border-radius: 0 0 6px 6px; padding: 8px; }
</style>

  <form class="navbar-form navbar-right" action="." method="get">
      <div class="form-group">
        <!-- search form -->
        <input id="search_box" name="search_box" type="text" placeholder="Localizar..." class="form-control">
        <button type="submit" class="btn btn-success form-control"><span class="glyphicon glyphicon-search"></span></button>
        <!-- status search form -->
        <ul class="list-inline">
          <li><a href="{% url 'proposal:proposal_list' %}"><i class="fa fa-list"></i></a></li>
          {% for item, item_display, classes in status %}
                  <li><a href="?status={{ item }}"><i class="fa fa-fw {{ classes }}"></i></a></li>
          {% endfor %}
        </ul>
      </div>
  </form>
  
    <h2><i class="fa fa-list"></i> Lista de Orçamentos</h2>
          Orçamentos mais recentes

  <div class="row">

    <div class="col-sm-12">

      {% for object in last_proposals %}

        <div class="col-xs-6 col-sm-4 col-lg-2">
          <div class="thumbnail">
            <div class="caption" style="height: 130px">
              <h4>
                <a href="{{ object.get_absolute_url }}">{{ object.codigo }}</a>
              </h4>
              <p class="flex-text text-muted">{{ object.work }}</p>
              <p class="flex-text text-muted">{{ object.work.customer }}</p>
            </div> <!-- /.caption -->
            <div class="car-footer"><i class="fa fa-fw {% status_icon object.status %}"></i> <small>{{ object.get_status_display }}</small></div>
          </div> <!-- /.thumbnail -->
        </div>

      {% endfor %}

    </div>

  </div>

  <div>
    {% if proposal_list %}
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Número</th>
            <th>Obra</th>
            <th>Cliente</th>
            <th>Categoria</th>
            <th>Funcionário</th>
            <th>Vendedor</th>
            <th>Status</th>
            <th class="text-center">Valor</th>
            <th class="text-center">Conclusão</th>
          </tr>
        </thead>
        <tbody>
        {% for proposal in proposal_list %}
          <tr>
            <td class="text-info" style="width:9%">
              <a href="{{ proposal.get_absolute_url }}">{{ proposal.codigo }} 
                <i class="fa fa-fw {% status_icon proposal.status %}"></i>
              </a>
            </td>
            
            <td>{{ proposal.work }}</td>
            <td>{{ proposal.work.customer }}</td>
            <td class="small">{{ proposal.get_category_display }}</td>
            <td class="small">{{ proposal.employee }}</td>
            <td class="small">{{ proposal.seller }}</td>

            <td style="width:12%">
              <i class="fa fa-fw {% status_icon proposal.status %}"></i> {{ proposal.get_status_display }}
            </td>

            {% if proposal.price %}
              <td class="text-right" style="width:15%">{{ proposal.get_price }}</td>
            {% else %}
              <td class="text-center">---</td>
            {% endif %}

            <td class="text-center">{{ proposal.date_conclusion|date:"d/m/Y"|default:"---" }}</td>

          </tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="alert alert-warning">Sem itens na lista.</p>
    {% endif %}
  </div>

    <hr>
  <div>
    <h3>{{ proposal_list|length }} entrada{{ proposal_list|length|pluralize }}</h3>
    <h4><b>Total:</b> {{ page_obj.paginator.count }} entrada{{ page_obj.paginator.count|pluralize }}</h4>
  </div>

<!-- pagination -->
{% include "pagination.html" %}

{% endblock content %}
